<!DOCTYPE html>
<html>
  <head>
    <title>Backbone.js Project 1</title>
    <link rel="stylesheet" href="app.css">
  </head>
  <body>
    <div id="app-views"></div>
    <script src="vendor.js"></script>
    <script src="app.js"></script>
    <script src="//www.parsecdn.com/js/parse-1.6.2.min.js"></script>

    <script>
      // This jQuery function is called when the HTML document is fully loaded.
      $(document).ready(function(){
        // backbone router 

        var Router = Backbone.Router.extend({
          Album: null,
          HomeView: null,
          TrackView: null,

          initialize: function() {
            Parse.initialize("3Fh2rJ9bqEWNVmNaYHYx9LpPLo9mpUxEp0jRKPCh", "gtt05pz8sTD2qq2OxYOAyM1aCtHbiPpOcACwHyzx");

            var Album = Parse.Object.extend("Album");

            AlbumListView = require("views/album-grid");
            this.HomeView = AlbumListView;

            TrackView = require("views/trackview");
            this.TrackView = TrackView;

            this.Album = Album;
            this.Container = $("#app-views");
          },

          routes: {
            "": "home",
            ":album": "tracks" 
          },

          home: function() {
            if (this.homeView == null) {
              this.homeView = new this.HomeView({model: new this.Album()});
            }

            this.Container.html(this.homeView.render().el)
          },
          
          tracks: function(album) {
            if (this.trackView == null) {
              console.log("album", album);
              var query = new Parse.Query(this.Album);
              query.get(album, {
                success: function(object) {
                  // Successfully retrieved the object.
                  console.log(object);
                  router.trackView = new TrackView(object);
                  router.Container.html(router.trackView.render().el);
                },
                error: function(error) {
                  alert("Error: " + error.code + " " + error.message);
                }
              });
            } 
          }
        });

        var router = new Router;

        Backbone.history.start({  
          pushState: true,
        });

      });
    </script>
  </body>
</html>
